<div id="groups" class="inspectors chrome" ng-controller="GroupsCtrl">
  <h2><span>Visual Layers</span> <a class="edit-vis" ng-click="editVisualization()" vde-tooltip="Visualization Properties">Edit Visualization</a> <a class="add" ng-click="addGroup()" vde-tooltip="New Group">New Group</a> </h2> 

  <div class="group" ng-repeat="(groupName, group) in gMdl.groups">
    <div ng-if="group.layer">
      <h3 ng-class="{expanded:activeGroup == group}" ng-click="toggleVisual(group)">{{groupName|inflector:'humanize'}} <a ng-click="removeVisual('group', groupName);" class="remove" vde-tooltip="Delete Group">Delete Group</a></h3>

      <div ng-if="activeGroup == group">

        <h4>Axes <a ng-click="addAxis()" class="add" vde-tooltip="New Axis">New Axis</a></h4>
        
        <ul>
          <li ng-repeat="(axisName, axis) in group.axes" ng-class="{selected:activeVisual==axis}" ng-click="toggleVisual(axis)">
            <h5>{{axis.name|inflector:'humanize'}} <a ng-click="removeVisual('axes', axis.name);" class="remove" vde-tooltip="Delete Axis">Delete Axis</a></h5>

            <ng-include src="'tmpl/inspectors/axis.html'" ng-show="activeVisual==axis"></ng-include>
          </li>
        </ul>

        <h4>Marks</h4>
        
        <ul>
          <li ng-repeat="(markName, mark) in group.marks" ng-class="{selected:activeVisual==mark}" ng-click="toggleVisual(mark)">
            <h5>{{mark.displayName|inflector:'humanize'}} <a ng-click="removeVisual('marks', mark.name);" class="remove" vde-tooltip="Delete Mark">Delete Mark</a></h5>

            <div ng-if="activeVisual==mark" ng-init="gMdl.activeVisualPipeline = activeVisual.pipeline().name || ''">
              <vde-property label="Name" type="text" item="activeVisual" ng-model="activeVisual.displayName" nodrop="1"></vde-property>

              <vde-property label="Pipeline" nodrop="1">
                <select ng-model="gMdl.activeVisualPipeline" ng-change="setPipeline()">
                  <option value="">Select...</option>
                  <option ng-repeat="(pipelineName, pipeline) in gMdl.pipelines" value="{{pipelineName}}" ng-selected="gMdl.activeVisualPipeline==pipelineName||activeVisual.pipelineName==pipelineName">{{pipeline.displayName|inflector:'humanize'}}</option>
                  <option value="vdeNewPipeline">New Pipeline</option>
                </select>

                <p ng-if="activeVisual.pipeline().forkName"><label><input type="checkbox" ng-model="activeVisual.oncePerFork" /> Once per facet</label></p>
              </vde-property>

              <ng-include src="'tmpl/inspectors/' + mark.type + '.html'"></ng-include>
            </div>
          </li>
        </ul>

      </div>
    </div>
  </div>
</div>

